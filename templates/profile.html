{% extends "base.html" %}
{% block title %}My Profile{% endblock %}

{% block content %}
<style>
    .profile-container {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 2rem;
        padding: 2rem 0;
    }
    
    .profile-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 1rem;
        padding: 1.5rem;
        height: fit-content;
    }

    .section-title {
        font-family: var(--font-serif);
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
        border-bottom: 1px solid var(--border);
        padding-bottom: 0.5rem;
    }

    /* Book List Styles */
    .book-progress-item {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--border);
    }
    .book-progress-item:last-child { border-bottom: none; }
    
    .book-thumb {
        width: 60px;
        height: 90px;
        object-fit: cover;
        border-radius: 4px;
    }
    
    .book-info h4 { margin: 0 0 0.25rem 0; }
    .book-info p { margin: 0; font-size: 0.9rem; color: var(--text-secondary); }
    
    /* Review List Styles */
    .review-item {
        background: var(--bg);
        padding: 1rem;
        border-radius: 0.5rem;
        margin-bottom: 1rem;
        border-left: 4px solid var(--border);
    }
    .review-item.approved { border-left-color: #10b981; } /* Green */
    .review-item.pending { border-left-color: #f59e0b; }  /* Orange */

    .status-badge {
        display: inline-block;
        font-size: 0.75rem;
        padding: 0.1rem 0.5rem;
        border-radius: 1rem;
        background: var(--bg-secondary);
        border: 1px solid var(--border);
    }

    @media (max-width: 768px) {
        .profile-container { grid-template-columns: 1fr; }
    }
</style>

<div class="profile-container">
    <div class="profile-card">
        <h3 class="section-title">Account Settings</h3>
        
        <form method="POST">
            <div class="form-group" style="margin-bottom: 1rem;">
                <label style="display:block; margin-bottom:0.5rem; font-weight:500;">Username</label>
                <input type="text" name="username" value="{{ current_user.username }}" class="form-control" style="width:100%; padding:0.5rem; border-radius:0.375rem; border:1px solid var(--border); background:var(--bg); color:var(--text);">
            </div>

            <div class="form-group" style="margin-bottom: 1rem;">
                <label style="display:block; margin-bottom:0.5rem; font-weight:500;">Email Address</label>
                <input type="email" name="email" value="{{ current_user.email or '' }}" placeholder="Add your email" class="form-control" style="width:100%; padding:0.5rem; border-radius:0.375rem; border:1px solid var(--border); background:var(--bg); color:var(--text);">
            </div>

            <button type="submit" class="btn btn-primary" style="width:100%; margin-bottom:1rem;">Update Profile</button>
        </form>

        <div style="text-align: center; border-top: 1px solid var(--border); padding-top: 1rem;">
            <a href="{{ url_for('change_password') }}" style="color: var(--primary); text-decoration: none; font-size: 0.9rem;">Change Password</a>
        </div>
    </div>

    <div class="activity-column">
        
        <div class="profile-card" style="margin-bottom: 2rem;">
            <h3 class="section-title">Continue Reading</h3>
            {% if my_books %}
                {% for item in my_books %}
                <div class="book-progress-item">
                    <img src="{{ item.book.image_url }}" alt="{{ item.book.title }}" class="book-thumb">
                    <div class="book-info">
                        <h4>{{ item.book.title }}</h4>
                        <p>Last read: <strong>Chapter {{ item.chapter.chapter_number }}</strong></p>
                        <p style="font-size: 0.8rem; margin-top: 0.5rem;">{{ item.last_read_at.strftime('%d %b %Y') }}</p>
                        <a href="{{ url_for('read_chapter', book_id=item.book_id, chapter_id=item.chapter_id) }}" class="btn btn-small btn-secondary" style="margin-top:0.5rem; display:inline-block; padding: 0.25rem 0.75rem; font-size: 0.8rem;">Resume</a>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p style="color: var(--text-secondary); font-style: italic;">You haven't started any books yet.</p>
                <a href="{{ url_for('home') }}" class="btn btn-primary">Browse Library</a>
            {% endif %}
        </div>

        <div class="profile-card">
            <h3 class="section-title">My Reviews</h3>
            {% if my_reviews %}
                {% for review in my_reviews %}
                <div class="review-item {{ 'approved' if review.approved else 'pending' }}">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.5rem;">
                        <strong>{{ review.book.title }}</strong>
                        <span class="status-badge">{{ 'Published' if review.approved else 'Pending Approval' }}</span>
                    </div>
                    <p style="color: var(--text-secondary); font-size: 0.95rem;">"{{ review.content }}"</p>
                    <small style="color: var(--text-secondary); opacity: 0.7;">{{ review.created_at.strftime('%d %b %Y') }}</small>
                </div>
                {% endfor %}
            {% else %}
                <p style="color: var(--text-secondary);">You haven't posted any reviews yet.</p>
            {% endif %}
        </div>

    </div>
</div>
{% endblock %}